{"version":3,"sources":["knockout.mapping-latest.js","knockout.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"manage-users.js","sourcesContent":["/// Knockout Mapping plugin v2.4.1\r\n/// (c) 2013 Steven Sanderson, Roy Jacobs - http://knockoutjs.com/\r\n/// License: MIT (http://www.opensource.org/licenses/mit-license.php)\r\n(function(e){\"function\"===typeof require&&\"object\"===typeof exports&&\"object\"===typeof module?e(require(\"knockout\"),exports):\"function\"===typeof define&&define.amd?define([\"knockout\",\"exports\"],e):e(ko,ko.mapping={})})(function(e,f){function y(b,c){var a,d;for(d in c)if(c.hasOwnProperty(d)&&c[d])if(a=f.getType(b[d]),d&&b[d]&&\"array\"!==a&&\"string\"!==a)y(b[d],c[d]);else if(\"array\"===f.getType(b[d])&&\"array\"===f.getType(c[d])){a=b;for(var e=d,l=b[d],n=c[d],t={},g=l.length-1;0<=g;--g)t[l[g]]=l[g];for(g=\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          n.length-1;0<=g;--g)t[n[g]]=n[g];l=[];n=void 0;for(n in t)l.push(t[n]);a[e]=l}else b[d]=c[d]}function E(b,c){var a={};y(a,b);y(a,c);return a}function z(b,c){for(var a=E({},b),e=L.length-1;0<=e;e--){var f=L[e];a[f]&&(a[\"\"]instanceof Object||(a[\"\"]={}),a[\"\"][f]=a[f],delete a[f])}c&&(a.ignore=h(c.ignore,a.ignore),a.include=h(c.include,a.include),a.copy=h(c.copy,a.copy),a.observe=h(c.observe,a.observe));a.ignore=h(a.ignore,j.ignore);a.include=h(a.include,j.include);a.copy=h(a.copy,j.copy);a.observe=h(a.observe,\r\n    j.observe);a.mappedProperties=a.mappedProperties||{};a.copiedProperties=a.copiedProperties||{};return a}function h(b,c){\"array\"!==f.getType(b)&&(b=\"undefined\"===f.getType(b)?[]:[b]);\"array\"!==f.getType(c)&&(c=\"undefined\"===f.getType(c)?[]:[c]);return e.utils.arrayGetDistinctValues(b.concat(c))}function F(b,c,a,d,k,l,n){var t=\"array\"===f.getType(e.utils.unwrapObservable(c));l=l||\"\";if(f.isMapped(b)){var g=e.utils.unwrapObservable(b)[p];a=E(g,a)}var j=n||k,h=function(){return a[d]&&a[d].create instanceof\r\n    Function},x=function(b){var f=G,g=e.dependentObservable;e.dependentObservable=function(a,b,c){c=c||{};a&&\"object\"==typeof a&&(c=a);var d=c.deferEvaluation,M=!1;c.deferEvaluation=!0;a=new H(a,b,c);if(!d){var g=a,d=e.dependentObservable;e.dependentObservable=H;a=e.isWriteableObservable(g);e.dependentObservable=d;d=H({read:function(){M||(e.utils.arrayRemoveItem(f,g),M=!0);return g.apply(g,arguments)},write:a&&function(a){return g(a)},deferEvaluation:!0});d.__DO=g;a=d;f.push(a)}return a};e.dependentObservable.fn=\r\n    H.fn;e.computed=e.dependentObservable;b=e.utils.unwrapObservable(k)instanceof Array?a[d].create({data:b||c,parent:j,skip:N}):a[d].create({data:b||c,parent:j});e.dependentObservable=g;e.computed=e.dependentObservable;return b},u=function(){return a[d]&&a[d].update instanceof Function},v=function(b,f){var g={data:f||c,parent:j,target:e.utils.unwrapObservable(b)};e.isWriteableObservable(b)&&(g.observable=b);return a[d].update(g)};if(n=I.get(c))return n;d=d||\"\";if(t){var t=[],s=!1,m=function(a){return a};\r\n    a[d]&&a[d].key&&(m=a[d].key,s=!0);e.isObservable(b)||(b=e.observableArray([]),b.mappedRemove=function(a){var c=\"function\"==typeof a?a:function(b){return b===m(a)};return b.remove(function(a){return c(m(a))})},b.mappedRemoveAll=function(a){var c=C(a,m);return b.remove(function(a){return-1!=e.utils.arrayIndexOf(c,m(a))})},b.mappedDestroy=function(a){var c=\"function\"==typeof a?a:function(b){return b===m(a)};return b.destroy(function(a){return c(m(a))})},b.mappedDestroyAll=function(a){var c=C(a,m);return b.destroy(function(a){return-1!=\r\n        e.utils.arrayIndexOf(c,m(a))})},b.mappedIndexOf=function(a){var c=C(b(),m);a=m(a);return e.utils.arrayIndexOf(c,a)},b.mappedGet=function(a){return b()[b.mappedIndexOf(a)]},b.mappedCreate=function(a){if(-1!==b.mappedIndexOf(a))throw Error(\"There already is an object with the key that you specified.\");var c=h()?x(a):a;u()&&(a=v(c,a),e.isWriteableObservable(c)?c(a):c=a);b.push(c);return c});n=C(e.utils.unwrapObservable(b),m).sort();g=C(c,m);s&&g.sort();s=e.utils.compareArrays(n,g);n={};var J,A=e.utils.unwrapObservable(c),\r\n        y={},z=!0,g=0;for(J=A.length;g<J;g++){var r=m(A[g]);if(void 0===r||r instanceof Object){z=!1;break}y[r]=A[g]}var A=[],B=0,g=0;for(J=s.length;g<J;g++){var r=s[g],q,w=l+\"[\"+g+\"]\";switch(r.status){case \"added\":var D=z?y[r.value]:K(e.utils.unwrapObservable(c),r.value,m);q=F(void 0,D,a,d,b,w,k);h()||(q=e.utils.unwrapObservable(q));w=O(e.utils.unwrapObservable(c),D,n);q===N?B++:A[w-B]=q;n[w]=!0;break;case \"retained\":D=z?y[r.value]:K(e.utils.unwrapObservable(c),r.value,m);q=K(b,r.value,m);F(q,D,a,d,b,w,\r\n        k);w=O(e.utils.unwrapObservable(c),D,n);A[w]=q;n[w]=!0;break;case \"deleted\":q=K(b,r.value,m)}t.push({event:r.status,item:q})}b(A);a[d]&&a[d].arrayChanged&&e.utils.arrayForEach(t,function(b){a[d].arrayChanged(b.event,b.item)})}else if(P(c)){b=e.utils.unwrapObservable(b);if(!b){if(h())return s=x(),u()&&(s=v(s)),s;if(u())return v(s);b={}}u()&&(b=v(b));I.save(c,b);if(u())return b;Q(c,function(d){var f=l.length?l+\".\"+d:d;if(-1==e.utils.arrayIndexOf(a.ignore,f))if(-1!=e.utils.arrayIndexOf(a.copy,f))b[d]=\r\n    c[d];else if(\"object\"!=typeof c[d]&&\"array\"!=typeof c[d]&&0<a.observe.length&&-1==e.utils.arrayIndexOf(a.observe,f))b[d]=c[d],a.copiedProperties[f]=!0;else{var g=I.get(c[d]),k=F(b[d],c[d],a,d,b,f,b),g=g||k;if(0<a.observe.length&&-1==e.utils.arrayIndexOf(a.observe,f))b[d]=g(),a.copiedProperties[f]=!0;else{if(e.isWriteableObservable(b[d])){if(g=e.utils.unwrapObservable(g),b[d]()!==g)b[d](g)}else g=void 0===b[d]?g:e.utils.unwrapObservable(g),b[d]=g;a.mappedProperties[f]=!0}}})}else switch(f.getType(c)){case \"function\":u()?\r\n    e.isWriteableObservable(c)?(c(v(c)),b=c):b=v(c):b=c;break;default:if(e.isWriteableObservable(b))return q=u()?v(b):e.utils.unwrapObservable(c),b(q),q;h()||u();b=h()?x():e.observable(e.utils.unwrapObservable(c));u()&&b(v(b))}return b}function O(b,c,a){for(var d=0,e=b.length;d<e;d++)if(!0!==a[d]&&b[d]===c)return d;return null}function R(b,c){var a;c&&(a=c(b));\"undefined\"===f.getType(a)&&(a=b);return e.utils.unwrapObservable(a)}function K(b,c,a){b=e.utils.unwrapObservable(b);for(var d=0,f=b.length;d<\r\n    f;d++){var l=b[d];if(R(l,a)===c)return l}throw Error(\"When calling ko.update*, the key '\"+c+\"' was not found!\");}function C(b,c){return e.utils.arrayMap(e.utils.unwrapObservable(b),function(a){return c?R(a,c):a})}function Q(b,c){if(\"array\"===f.getType(b))for(var a=0;a<b.length;a++)c(a);else for(a in b)c(a)}function P(b){var c=f.getType(b);return(\"object\"===c||\"array\"===c)&&null!==b}function T(){var b=[],c=[];this.save=function(a,d){var f=e.utils.arrayIndexOf(b,a);0<=f?c[f]=d:(b.push(a),c.push(d))};\r\n    this.get=function(a){a=e.utils.arrayIndexOf(b,a);return 0<=a?c[a]:void 0}}function S(){var b={},c=function(a){var c;try{c=a}catch(e){c=\"$$$\"}a=b[c];void 0===a&&(a=new T,b[c]=a);return a};this.save=function(a,b){c(a).save(a,b)};this.get=function(a){return c(a).get(a)}}var p=\"__ko_mapping__\",H=e.dependentObservable,B=0,G,I,L=[\"create\",\"update\",\"key\",\"arrayChanged\"],N={},x={include:[\"_destroy\"],ignore:[],copy:[],observe:[]},j=x;f.isMapped=function(b){return(b=e.utils.unwrapObservable(b))&&b[p]};f.fromJS=\r\n    function(b){if(0==arguments.length)throw Error(\"When calling ko.fromJS, pass the object you want to convert.\");try{B++||(G=[],I=new S);var c,a;2==arguments.length&&(arguments[1][p]?a=arguments[1]:c=arguments[1]);3==arguments.length&&(c=arguments[1],a=arguments[2]);a&&(c=E(c,a[p]));c=z(c);var d=F(a,b,c);a&&(d=a);if(!--B)for(;G.length;){var e=G.pop();e&&(e(),e.__DO.throttleEvaluation=e.throttleEvaluation)}d[p]=E(d[p],c);return d}catch(f){throw B=0,f;}};f.fromJSON=function(b){var c=e.utils.parseJson(b);\r\n    arguments[0]=c;return f.fromJS.apply(this,arguments)};f.updateFromJS=function(){throw Error(\"ko.mapping.updateFromJS, use ko.mapping.fromJS instead. Please note that the order of parameters is different!\");};f.updateFromJSON=function(){throw Error(\"ko.mapping.updateFromJSON, use ko.mapping.fromJSON instead. Please note that the order of parameters is different!\");};f.toJS=function(b,c){j||f.resetDefaultOptions();if(0==arguments.length)throw Error(\"When calling ko.mapping.toJS, pass the object you want to convert.\");\r\n    if(\"array\"!==f.getType(j.ignore))throw Error(\"ko.mapping.defaultOptions().ignore should be an array.\");if(\"array\"!==f.getType(j.include))throw Error(\"ko.mapping.defaultOptions().include should be an array.\");if(\"array\"!==f.getType(j.copy))throw Error(\"ko.mapping.defaultOptions().copy should be an array.\");c=z(c,b[p]);return f.visitModel(b,function(a){return e.utils.unwrapObservable(a)},c)};f.toJSON=function(b,c){var a=f.toJS(b,c);return e.utils.stringifyJson(a)};f.defaultOptions=function(){if(0<arguments.length)j=\r\n    arguments[0];else return j};f.resetDefaultOptions=function(){j={include:x.include.slice(0),ignore:x.ignore.slice(0),copy:x.copy.slice(0)}};f.getType=function(b){if(b&&\"object\"===typeof b){if(b.constructor===Date)return\"date\";if(b.constructor===Array)return\"array\"}return typeof b};f.visitModel=function(b,c,a){a=a||{};a.visitedObjects=a.visitedObjects||new S;var d,k=e.utils.unwrapObservable(b);if(P(k))a=z(a,k[p]),c(b,a.parentName),d=\"array\"===f.getType(k)?[]:{};else return c(b,a.parentName);a.visitedObjects.save(b,\r\n    d);var l=a.parentName;Q(k,function(b){if(!(a.ignore&&-1!=e.utils.arrayIndexOf(a.ignore,b))){var j=k[b],g=a,h=l||\"\";\"array\"===f.getType(k)?l&&(h+=\"[\"+b+\"]\"):(l&&(h+=\".\"),h+=b);g.parentName=h;if(!(-1===e.utils.arrayIndexOf(a.copy,b)&&-1===e.utils.arrayIndexOf(a.include,b)&&k[p]&&k[p].mappedProperties&&!k[p].mappedProperties[b]&&k[p].copiedProperties&&!k[p].copiedProperties[b]&&\"array\"!==f.getType(k)))switch(f.getType(e.utils.unwrapObservable(j))){case \"object\":case \"array\":case \"undefined\":g=a.visitedObjects.get(j);\r\n    d[b]=\"undefined\"!==f.getType(g)?g:f.visitModel(j,c,a);break;default:d[b]=c(j,a.parentName)}}});return d}});","$.urlParam = function(name){\r\n    var results = new RegExp('[\\\\?&]' + name + '=([^&#]*)').exec(window.location.href);\r\n    if (results==null){\r\n        return null;\r\n    }\r\n    else{\r\n        return results[1] || 0;\r\n    }\r\n};\r\n\r\nvar manage_team_view_model = new ManageTeamViewModel();\r\n\r\nfunction ManageTeamViewModel() {\r\n    var self = this;\r\n\r\n    self.selected_team = ko.observable();\r\n\r\n    self.team_found = ko.observable(false);\r\n\r\n    self.team = ko.observable();\r\n\r\n    self.organisation = ko.observable();\r\n\r\n    self.organisation_teams = ko.observableArray([]);\r\n\r\n    self.show_inactive = ko.observable(false);\r\n\r\n    self.roles = ko.observableArray([]);\r\n\r\n    self.error_modal = {\r\n        error_message: ko.observable(),\r\n        error_code: ko.observable(),\r\n        show: ko.observable(false), /* Set to true to show initially */\r\n        body: ko.observable(),\r\n        header: ko.observable(),\r\n        onClose: function() {\r\n\r\n        }\r\n    };\r\n\r\n    self.confirm_modal = {\r\n        confirm_message: ko.observable(),\r\n        active: ko.observable(),\r\n        show: ko.observable(false),\r\n        onClose: function(){},\r\n        onAction: function() {\r\n            if(self.confirm_modal.active()) {\r\n                $.post(\r\n                    \"user/activate-user\",\r\n                    {user_id: self.confirm_modal.user.user_id()},\r\n                    function(returnedData) {\r\n                        self.confirm_modal.show(false);\r\n                        self.confirm_modal.user.active(true);\r\n                    }\r\n                );\r\n            } else {\r\n                $.post(\r\n                    \"user/deactivate-user\",\r\n                    {user_id: self.confirm_modal.user.user_id()},\r\n                    function(returnedData) {\r\n                        self.confirm_modal.show(false);\r\n                        self.confirm_modal.user.active(false);\r\n                    }\r\n                );\r\n            }\r\n        }\r\n    };\r\n\r\n    self.cti_softphone_modal = {\r\n        integration: new Integration({'EmployeeAlias': 0}),\r\n        show: ko.observable(false),\r\n        onClose: function(){},\r\n        onAction: function() {\r\n            $.post(\r\n                \"integration/user-integration\",\r\n                ko.toJSON(this.integration),\r\n                function(returnedData) {\r\n                    self.cti_softphone_modal.show(false);\r\n                }\r\n            );\r\n        }\r\n    };\r\n\r\n    self.showErrorModal = function(error_message, error_code) {\r\n        self.error_modal.show(true);\r\n        self.error_modal.error_message(error_message);\r\n        self.error_modal.error_code(error_code);\r\n\r\n        if(error_code < 500) {\r\n            self.error_modal.header(\"Notice\");\r\n            self.error_modal.body(\"Please Note:\");\r\n        } else if(error_code < 1000) {\r\n            self.error_modal.header(\"Warning\");\r\n            self.error_modal.body(\"Warning:\");\r\n        } else if(error_code < 1500) {\r\n            self.error_modal.header(\"Error\");\r\n            self.error_modal.body(\"The application has encountered an error:\");\r\n        } else {\r\n            self.error_modal.header(\"Fatal Error\");\r\n            self.error_modal.body(\"The application has encountered a fatal error:\");\r\n        }\r\n    };\r\n\r\n    self.showConfirmModal = function(user, active, confirm_message) {\r\n        self.confirm_modal.show(true);\r\n        self.confirm_modal.user = user;\r\n        self.confirm_modal.active(active);\r\n        self.confirm_modal.confirm_message(confirm_message);\r\n    };\r\n\r\n    self.showCtiSoftphoneModal = function(integration_id, user) {\r\n        var modal = self.cti_softphone_modal;\r\n        modal.user = user;\r\n        $.getJSON(\"integration/user-integration\", {user_id: user.user_id(), integration_id: integration_id}, function(data) {\r\n            modal.integration.addIntegration(data.data);\r\n            modal.show(true);\r\n        });\r\n    };\r\n\r\n    self.deactivateMember = function(user) {\r\n        self.showConfirmModal(user, false, \"Are you sure you want to deactivate this user?\");\r\n    };\r\n\r\n    self.reactivateMember = function(user) {\r\n        self.showConfirmModal(user, true, \"Are you sure you want to reactivate this user?\");\r\n    };\r\n    self.team_selection = ko.observable(); //for moving users from teams\r\n    self.organisation_teams = ko.observableArray();\r\n    self.getTeam = function() {\r\n        var data = { team_id: self.selected_team() };\r\n        $.getJSON(\"team/team\", data, function(allData) {\r\n            if(allData['result'] == 0) {\r\n                self.team_found(true);\r\n                self.team(null);\r\n                if(allData.data.organisation != undefined) {\r\n                    self.organisation(allData.data.organisation);\r\n                }\r\n                var tmpTeamList = allData.data.organisation_teams;\r\n                var teamList = [];\r\n                for(var i = 0; i < tmpTeamList.length; i++) {\r\n                    var team = new Team(tmpTeamList[i]);\r\n                    teamList.push(team);\r\n                }\r\n                self.organisation_teams(teamList);\r\n                if(typeof allData.data.team !== 'undefined'){\r\n                    self.team(new Team(allData.data.team));\r\n                    self.team_selection(allData.data.team.id);\r\n                    self.edit_modal.team_name(allData.data.team.name);\r\n                    history.pushState({}, null, \"manage_users?team_id=\" + self.team().id());\r\n                }\r\n            } else {\r\n                self.showErrorModal(allData['result'], allData['message']);\r\n            }\r\n        });\r\n    };\r\n\r\n    self.edit_modal = {\r\n        header: \"Edit Team Member\",\r\n        first_name: ko.observable(),\r\n        last_name: ko.observable(),\r\n        phone_one: ko.observable(),\r\n        phone_two: ko.observable(),\r\n        email: ko.observable(),\r\n        gender: ko.observable(),\r\n        role_ids: ko.observableArray(),\r\n        address: ko.observable(),\r\n        post_code: ko.observable(),\r\n        city: ko.observable(),\r\n        pay_rate: ko.observable(),\r\n        billable_rate: ko.observable(),\r\n        unit_type: ko.observable(),\r\n        primary_contact: ko.observable(),\r\n        team_id: ko.observable(),\r\n        team_name: ko.observable(),\r\n        timezone: ko.observable(),\r\n        closeLabel: \"Cancel\",\r\n        primaryLabel: \"Save\",\r\n        show: ko.observable(false),\r\n\r\n        onClose: function() {\r\n\r\n        },\r\n        onAction: function() {\r\n            self.edit_modal.user.first_name(self.edit_modal.first_name());\r\n            self.edit_modal.user.last_name(self.edit_modal.last_name());\r\n            self.edit_modal.user.phone_one(self.edit_modal.phone_one());\r\n            self.edit_modal.user.phone_two(self.edit_modal.phone_two());\r\n            self.edit_modal.user.email(self.edit_modal.email());\r\n            self.edit_modal.user.gender(self.edit_modal.gender());\r\n            self.edit_modal.user.roles(self.edit_modal.role_ids());\r\n            self.edit_modal.user.address(self.edit_modal.address());\r\n            self.edit_modal.user.post_code(self.edit_modal.post_code());\r\n            self.edit_modal.user.city(self.edit_modal.city());\r\n            self.edit_modal.user.pay_rate(self.edit_modal.pay_rate());\r\n            self.edit_modal.user.billable_rate(self.edit_modal.billable_rate());\r\n            self.edit_modal.user.unit_type(self.edit_modal.unit_type());\r\n            self.edit_modal.user.team_id(self.team_selection());\r\n            self.edit_modal.user.timezone(self.edit_modal.timezone());\r\n            self.edit_modal.user.primary_contact(self.edit_modal.primary_contact());\r\n            if( self.edit_modal.first_name() === \"\" ||\r\n                self.edit_modal.last_name() === \"\" ||\r\n                self.edit_modal.email() === \"\" ){\r\n                alert(\"Error: You have not completed all of the required fields\");\r\n            } else {\r\n                self.edit_modal.show(false);\r\n                var jsonData = ko.toJSON(self.edit_modal.user);\r\n                $.post(\r\n                    \"user/user\",\r\n                    {data: jsonData},\r\n                    function(returnedData) {\r\n                        if(returnedData['result'] == 0) {\r\n\r\n                            //remove this member if change teams.;\r\n                            if(self.team_selection() != self.team().id()) {\r\n                                var tmp_index = 0;\r\n                                for(var i = 0; i < self.team().team_members().length; i++) {\r\n                                    var member = self.team().team_members()[i];\r\n                                    if(member.user_id() == returnedData.data.id) {\r\n                                        tmp_index = i;\r\n                                    }\r\n                                }\r\n                                self.team().team_members.splice(tmp_index, 1);\r\n                                self.team().team_members.notifySubscribers();\r\n                            }\r\n                            if(typeof returnedData.data.id !== 'undefined' && self.edit_modal.user.user_id() === \"\") {\r\n                                self.edit_modal.user.user_id(returnedData.data.id);\r\n                                self.team().team_members.push(self.edit_modal.user);\r\n                                self.team().team_members.notifySubscribers();\r\n                            }\r\n                        } else {\r\n                            alert(\"Error \" + returnedData['result'] + \": \" + returnedData['message']);\r\n                        }\r\n                    }\r\n                );\r\n            }\r\n        }\r\n    };\r\n\r\n    self.editMember = function(user) {\r\n        self.edit_modal.user = user;\r\n        self.edit_modal.first_name(user.first_name());\r\n        self.edit_modal.last_name(user.last_name());\r\n        self.edit_modal.phone_one(user.phone_one());\r\n        self.edit_modal.phone_two(user.phone_two());\r\n        self.edit_modal.email(user.email());\r\n        self.edit_modal.gender(user.gender());\r\n        self.edit_modal.role_ids(user.roles());\r\n        self.edit_modal.address(user.address());\r\n        self.edit_modal.post_code(user.post_code());\r\n        self.edit_modal.city(user.city());\r\n        self.edit_modal.pay_rate(user.pay_rate());\r\n        //self.edit_modal.billable_rate(user.billable_rate());\r\n        self.edit_modal.timezone(user.timezone());\r\n        self.edit_modal.unit_type(user.unit_type());\r\n        self.edit_modal.primary_contact(user.primary_contact());\r\n        self.team_selection(user.team_id());\r\n        self.edit_modal.show(true);\r\n    };\r\n\r\n    self.addMember = function() {\r\n        self.edit_modal.user = new Employee;\r\n        self.edit_modal.first_name(\"\");\r\n        self.edit_modal.last_name(\"\");\r\n        self.edit_modal.phone_one(\"\");\r\n        self.edit_modal.phone_two(\"\");\r\n        self.edit_modal.email(\"\");\r\n        self.edit_modal.gender(\"\");\r\n        self.edit_modal.role_ids([]);\r\n        self.edit_modal.address(\"\");\r\n        self.edit_modal.post_code(\"\");\r\n        self.edit_modal.city(\"\");\r\n        self.edit_modal.pay_rate(\"\");\r\n        self.edit_modal.billable_rate(\"\");\r\n        self.edit_modal.unit_type(\"\");\r\n        if(self.organisation() != undefined) {\r\n            if(self.organisation().timezone != undefined && self.organisation().timezone != null) {\r\n                self.edit_modal.timezone(self.organisation().timezone);\r\n            } else {\r\n                self.edit_modal.timezone(\"\");\r\n            }\r\n        } else {\r\n            self.edit_modal.timezone(\"\");\r\n        }\r\n        self.edit_modal.primary_contact(false);\r\n        self.edit_modal.show(true);\r\n    };\r\n\r\n    self.resetPassword = function(user) {\r\n        var r = confirm(\"Are you sure you want to reset \" + user.full_name() +\"'s password?\");\r\n\r\n        if(r == true) {\r\n            $.post(\r\n                \"remindajax\",\r\n                {email: user.email()},\r\n                function(returnedData) {\r\n                }\r\n            );\r\n        }\r\n    };\r\n\r\n    $.getJSON(\"role/available-roles\", function(allData) {\r\n        if(allData.result == 0) {\r\n            $.each(allData.data, function(key, val) {\r\n                self.roles.push(new Role(key, val));\r\n            });\r\n        }\r\n    });\r\n\r\n    if($.urlParam('team_id') != null) {\r\n        self.selected_team($.urlParam('team_id'));\r\n        self.getTeam();\r\n    }\r\n}\r\n\r\nfunction Team(team) {\r\n    this.id = ko.observable(team.id);\r\n    this.name = ko.observable(team.name);\r\n    this.team_leader_id = ko.observable(team.team_leader_id);\r\n    this.manager_id = ko.observable(team.manager_id);\r\n\r\n    this.team_members = ko.observableArray([]);\r\n\r\n    var parent = this;\r\n    if(team.user !== undefined) {\r\n        $.each(team.user, function(key, val) {\r\n            if(typeof val !== 'undefined') {\r\n                var employee = new Employee;\r\n                employee.addEmployee(val);\r\n                parent.team_members.push(employee);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nfunction Employee() {\r\n    this.user_id = ko.observable(\"\");\r\n    this.first_name = ko.observable(\"\");\r\n    this.last_name = ko.observable(\"\");\r\n\r\n    this.full_name = ko.computed(\r\n        function() {\r\n            return this.first_name() + \" \" + this.last_name();\r\n        },\r\n        this\r\n    );\r\n    this.active = ko.observable(true);\r\n    this.email = ko.observable(\"\");\r\n    this.gender = ko.observable(\"\");\r\n    this.roles = ko.observableArray([]);\r\n    this.phone_one = ko.observable(\"\");\r\n    this.phone_two = ko.observable(\"\");\r\n    this.address = ko.observable(\"\");\r\n    this.post_code = ko.observable(\"\");\r\n    this.city = ko.observable(\"\");\r\n    this.pay_rate = ko.observable(\"\");\r\n    this.billable_rate = ko.observable(\"\");\r\n    this.timezone = ko.observable(\"\");\r\n    this.unit_type = ko.observable(\"\");\r\n    this.team_id = ko.observable(\"\");\r\n    this.team_name = ko.observable(\"\");\r\n    this.gravatar_address = ko.observable(\"\");\r\n    this.primary_contact = ko.observable(false);\r\n}\r\n\r\nEmployee.prototype.addEmployee = function(user) {\r\n    var self = this;\r\n    this.user_id(user.id);\r\n    this.first_name(user.first_name);\r\n    this.last_name(user.last_name);\r\n\r\n    this.active(user.active);\r\n    this.email(user.email);\r\n    this.gender(user.gender);\r\n    $.each(user.role, function(key, val) {\r\n        self.roles.push(val.id);\r\n    });\r\n    this.phone_one(user.phone_one);\r\n    this.phone_two(user.phone_two);\r\n    this.address(user.address);\r\n    this.post_code(user.post_code);\r\n    this.primary_contact(user.primary_contact);\r\n    if(typeof user.city !== 'undefined' && user.city !== null) {\r\n        this.city(user.city.city_name);\r\n    }\r\n    if(typeof user.timezone !== 'undefined' && user.timezone !== null) {\r\n        this.timezone(user.timezone);\r\n    }\r\n    if(user.payrate.length != 0){\r\n        this.pay_rate(Math.round(user.payrate[0].pay_rate*100)/100);\r\n        this.unit_type(user.payrate[0].unit_type);\r\n    }\r\n    if(user.billablerate.length != 0) this.billable_rate(Math.round(user.billablerate[0].billable_rate*100)/100);\r\n    this.team_id(user.team_id);\r\n    this.gravatar_address('//www.gravatar.com/avatar/' + md5(this.email()) + '?s=50&d=retro');\r\n};\r\n\r\nfunction Integration(user_configs) {\r\n    this.id = ko.observable(\"\");\r\n    this.user_id = ko.observable(\"\");\r\n    this.name = ko.observable(\"\");\r\n    this.configuration = {};\r\n    this.user_configuration = ko.mapping.fromJS(user_configs);\r\n}\r\n\r\nIntegration.prototype.addIntegration = function(integration) {\r\n    this.id(integration.id);\r\n    this.user_id(integration.user[0].id);\r\n    this.name(integration.name);\r\n    this.configuration = ko.mapping.fromJSON(integration.configuration);\r\n    this.user_configuration = ko.mapping.fromJSON(integration.user[0].pivot.configuration, this.user_configuration);\r\n};\r\n\r\nIntegration.prototype.toJSON = function() {\r\n    return {\r\n        id: this.id,\r\n        user_id: this.user_id,\r\n        name: this.name,\r\n        configuration: ko.mapping.toJS(this.configuration),\r\n        user_configuration: ko.mapping.toJS(this.user_configuration)\r\n    };\r\n};\r\n\r\nfunction Role(id, name) {\r\n    this.id = ko.observable(parseInt(id));\r\n    this.name = ko.observable(name);\r\n}\r\n\r\n/* Custom binding for making user edit modal */\r\nko.bindingHandlers.bootstrapModal = modal_handler(\"editModal\");\r\n\r\n/* Custom binding for making denial modal */\r\nko.bindingHandlers.bootstrapConfirmModal = modal_handler(\"bootstrapConfirmModal\");\r\n\r\n/* Custom binding for making cti/softphone modal */\r\nko.bindingHandlers.ctiSoftphoneIntegrationModal = modal_handler(\"ctiSoftphoneIntegrationModal\");\r\n\r\nfunction modal_handler(template) {\r\n    return {\r\n        init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {\r\n            var props = valueAccessor(),\r\n                vm = bindingContext.createChildContext(viewModel);\r\n            ko.utils.extend(vm, props);\r\n            vm.close = function() {\r\n                vm.show(false);\r\n                vm.onClose();\r\n            };\r\n            vm.action = function() {\r\n                vm.onAction();\r\n            };\r\n            ko.utils.toggleDomNodeCssClass(element, \"modal fade\", true);\r\n            ko.renderTemplate(template, vm, null, element);\r\n            var showHide = ko.computed(function() {\r\n                $(element).modal(vm.show() ? 'show' : 'hide');\r\n            });\r\n            return {\r\n                controlsDescendantBindings: true\r\n            };\r\n        }\r\n    };\r\n}\r\n\r\n\r\n// Activates knockout.js\r\nko.applyBindings(manage_team_view_model);"],"sourceRoot":"/source/"}